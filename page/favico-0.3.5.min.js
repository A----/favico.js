/**
 * @license MIT
 * @fileOverview Favico animations
 * @author Miroslav Magda, http://blog.ejci.net
 * @version 0.3.5
 */
!function(){var e=function(e){"use strict";function t(e){if(e.paused||e.ended||m)return!1;try{h.clearRect(0,0,c,s),h.drawImage(e,0,0,c,s)}catch(o){}x=setTimeout(t,S.duration,e),L.setIcon(l)}function o(e){var t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e&&e.replace(t,function(e,t,o,n){return t+t+o+o+n+n});var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:!1}function n(e,t){var o,n={};for(o in e)n[o]=e[o];for(o in t)n[o]=t[o];return n}function i(){return document.hidden||document.msHidden||document.webkitHidden||document.mozHidden}e=e?e:{};var r,a,s,c,l,h,d,f,u,y,g,m,w,p,x,b={bgColor:"#d00",textColor:"#fff",fontFamily:"sans-serif",fontStyle:"bold",type:"circle",position:"down",animation:"slide",elementId:!1};w={},w.ff="undefined"!=typeof InstallTrigger,w.chrome=!!window.chrome,w.opera=!!window.opera||navigator.userAgent.indexOf("Opera")>=0,w.ie=/*@cc_on!@*/!1,w.safari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,w.supported=w.chrome||w.ff||w.opera;var v=[];g=function(){},f=m=!1;var C=function(){r=n(b,e),r.bgColor=o(r.bgColor),r.textColor=o(r.textColor),r.strokeColor=o(r.strokeColor),r.position=r.position.toLowerCase(),r.animation=S.types[""+r.animation]?r.animation:b.animation;var t=r.position.indexOf("up")>-1,i=r.position.indexOf("left")>-1;if(t||i)for(var f=0;f<S.types[""+r.animation].length;f++){var u=S.types[""+r.animation][f];t&&(u.y=u.y<.6?u.y-.4:u.y-2*u.y+(1-u.w)),i&&(u.x=u.x<.6?u.x-.4:u.x-2*u.x+(1-u.h)),S.types[""+r.animation][f]=u}r.type=E[""+r.type]?r.type:b.type;try{a=L.getIcon(),l=document.createElement("canvas"),d=document.createElement("img"),a.hasAttribute("href")?(d.setAttribute("src",a.getAttribute("href")),d.onload=function(){s=d.height>0?d.height:32,c=d.width>0?d.width:32,l.height=s,l.width=c,h=l.getContext("2d"),I.ready()}):(d.setAttribute("src",""),s=32,c=32,d.height=s,d.width=c,l.height=s,l.width=c,h=l.getContext("2d"),I.ready())}catch(y){throw"Error initializing favico. Message: "+y.message}},I={};I.ready=function(){f=!0,I.reset(),g()},I.reset=function(){f&&(v=[],u=!1,y=!1,h.clearRect(0,0,c,s),h.drawImage(d,0,0,c,s),L.setIcon(l),window.clearTimeout(p),window.clearTimeout(x))},I.start=function(){if(f&&!y){var e=function(){u=v[0],y=!1,v.length>0&&(v.shift(),I.start())};if(v.length>0){y=!0;var t=function(){["type","animation","bgColor","textColor","fontFamily","fontStyle"].forEach(function(e){e in v[0].options&&(r[e]=v[0].options[e])}),S.run(v[0].options,function(){e()},!1)};u?S.run(u.options,function(){t()},!0):t()}}};var E={},M=function(e){return e.n="number"==typeof e.n?Math.abs(0|e.n):e.n,e.x=c*e.x,e.y=s*e.y,e.w=c*e.w,e.h=s*e.h,e.len=(""+e.n).length,e},T=function(e,t){e=M(e),2===e.len?(e.x=e.x-.4*e.w,e.w=1.4*e.w):e.len>=3&&(e.x=e.x-.65*e.w,e.w=1.65*e.w),h.clearRect(0,0,c,s),h.drawImage(d,0,0,c,s),h.beginPath(),h.textAlign="center",h.fillStyle="rgba("+r.bgColor.r+","+r.bgColor.g+","+r.bgColor.b+","+e.o+")",t(e),h.fillStyle="rgba("+r.textColor.r+","+r.textColor.g+","+r.textColor.b+","+e.o+")";var o,n,i;"number"==typeof e.n&&e.n>999?(o=(e.n>9999?9:Math.floor(e.n/1e3))+"k+",n=Math.floor(e.x+e.w/2),i=Math.floor(e.y+e.h-.2*e.h)):(o=e.n,n=Math.floor(e.x+e.w/2),i=Math.floor(e.y+e.h-.15*e.h)),e.strokeColor&&(h.strokeStyle="black",h.miterLimit=2,h.lineJoin="circle",h.lineWidth=3,h.strokeText(o,n,i),h.lineWidth=1),h.fillText(o,n,i),h.closePath()};E.none=function(e){h.font=r.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+r.fontFamily},E.circle=function(e){h.font=r.fontStyle+" "+Math.floor(e.h*(e.n>99?.85:1))+"px "+r.fontFamily,e.length>1?(h.moveTo(e.x+e.w/2,e.y),h.lineTo(e.x+e.w-e.h/2,e.y),h.quadraticCurveTo(e.x+e.w,e.y,e.x+e.w,e.y+e.h/2),h.lineTo(e.x+e.w,e.y+e.h-e.h/2),h.quadraticCurveTo(e.x+e.w,e.y+e.h,e.x+e.w-e.h/2,e.y+e.h),h.lineTo(e.x+e.h/2,e.y+e.h),h.quadraticCurveTo(e.x,e.y+e.h,e.x,e.y+e.h-e.h/2),h.lineTo(e.x,e.y+e.h/2),h.quadraticCurveTo(e.x,e.y,e.x+e.h/2,e.y)):h.arc(e.x+e.w/2,e.y+e.h/2,e.h/2,0,2*Math.PI),h.fillStyle="rgba("+r.bgColor.r+","+r.bgColor.g+","+r.bgColor.b+","+e.o+")",h.fill(),h.closePath(),h.beginPath(),h.stroke()},E.rectangle=function(e){h.font=r.fontStyle+" "+Math.floor(e.h*(e.n>99?.9:1))+"px "+r.fontFamily,h.fillStyle="rgba("+r.bgColor.r+","+r.bgColor.g+","+r.bgColor.b+","+e.o+")",h.fillRect(e.x,e.y,e.w,e.h)};var A=function(e,t){t=("string"==typeof t?{animation:t}:t)||{},g=function(){try{if("number"==typeof e?e>0:""!==e){var n={type:"badge",options:{n:e}};if("animation"in t&&S.types[""+t.animation]&&(n.options.animation=""+t.animation),"type"in t&&E[""+t.type]&&(n.options.type=""+t.type),["bgColor","textColor","strokeColor"].forEach(function(e){e in t&&(n.options[e]=o(t[e]))}),["fontStyle","fontFamily"].forEach(function(e){e in t&&(n.options[e]=t[e])}),v.push(n),v.length>100)throw"Too many badges requests in queue.";I.start()}else I.reset()}catch(i){throw"Error setting badge. Message: "+i.message}},f&&g()},U=function(e){g=function(){try{var t=e.width,o=e.height,n=document.createElement("img"),i=o/s>t/c?t/c:o/s;n.setAttribute("src",e.getAttribute("src")),n.height=o/i,n.width=t/i,h.clearRect(0,0,c,s),h.drawImage(n,0,0,c,s),L.setIcon(l)}catch(r){throw"Error setting image. Message: "+r.message}},f&&g()},R=function(e){g=function(){try{if("stop"===e)return m=!0,I.reset(),void(m=!1);e.addEventListener("play",function(){t(this)},!1)}catch(o){throw"Error setting video. Message: "+o.message}},f&&g()},k=function(e){if(window.URL&&window.URL.createObjectURL||(window.URL=window.URL||{},window.URL.createObjectURL=function(e){return e}),w.supported){var o=!1;navigator.getUserMedia=navigator.getUserMedia||navigator.oGetUserMedia||navigator.msGetUserMedia||navigator.mozGetUserMedia||navigator.webkitGetUserMedia,g=function(){try{if("stop"===e)return m=!0,I.reset(),void(m=!1);o=document.createElement("video"),o.width=c,o.height=s,navigator.getUserMedia({video:!0,audio:!1},function(e){o.src=URL.createObjectURL(e),o.play(),t(o)},function(){})}catch(n){throw"Error setting webcam. Message: "+n.message}},f&&g()}},L={};L.getIcon=function(){var e=!1,t="",o=function(){for(var e=document.getElementsByTagName("head")[0].getElementsByTagName("link"),t=e.length,o=t-1;o>=0;o--)if(/(^|\s)icon(\s|$)/i.test(e[o].getAttribute("rel")))return e[o];return!1};if(r.element?e=r.element:r.elementId?(e=document.getElementById(r.elementId),e.setAttribute("href",e.getAttribute("src"))):(e=o(),e===!1&&(e=document.createElement("link"),e.setAttribute("rel","icon"),document.getElementsByTagName("head")[0].appendChild(e))),t=r.elementId?e.src:e.href,"data:"!==t.substr(0,5)&&-1===t.indexOf(document.location.hostname))throw new Error("Error setting favicon. Favicon image is on different domain (Icon: "+t+", Domain: "+document.location.hostname+")");return e.setAttribute("type","image/png"),e},L.setIcon=function(e){var t=e.toDataURL("image/png");if(r.element)r.element.setAttribute("src",t);else if(r.elementId)document.getElementById(r.elementId).setAttribute("src",t);else if(w.ff||w.opera){var o=a;a=document.createElement("link"),w.opera&&a.setAttribute("rel","icon"),a.setAttribute("rel","icon"),a.setAttribute("type","image/png"),document.getElementsByTagName("head")[0].appendChild(a),a.setAttribute("href",t),o.parentNode&&o.parentNode.removeChild(o)}else a.setAttribute("href",t)};var S={};return S.duration=40,S.types={},S.types.fade=[{x:.4,y:.4,w:.6,h:.6,o:0},{x:.4,y:.4,w:.6,h:.6,o:.1},{x:.4,y:.4,w:.6,h:.6,o:.2},{x:.4,y:.4,w:.6,h:.6,o:.3},{x:.4,y:.4,w:.6,h:.6,o:.4},{x:.4,y:.4,w:.6,h:.6,o:.5},{x:.4,y:.4,w:.6,h:.6,o:.6},{x:.4,y:.4,w:.6,h:.6,o:.7},{x:.4,y:.4,w:.6,h:.6,o:.8},{x:.4,y:.4,w:.6,h:.6,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],S.types.none=[{x:.4,y:.4,w:.6,h:.6,o:1}],S.types.pop=[{x:1,y:1,w:0,h:0,o:1},{x:.9,y:.9,w:.1,h:.1,o:1},{x:.8,y:.8,w:.2,h:.2,o:1},{x:.7,y:.7,w:.3,h:.3,o:1},{x:.6,y:.6,w:.4,h:.4,o:1},{x:.5,y:.5,w:.5,h:.5,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],S.types.popFade=[{x:.75,y:.75,w:0,h:0,o:0},{x:.65,y:.65,w:.1,h:.1,o:.2},{x:.6,y:.6,w:.2,h:.2,o:.4},{x:.55,y:.55,w:.3,h:.3,o:.6},{x:.5,y:.5,w:.4,h:.4,o:.8},{x:.45,y:.45,w:.5,h:.5,o:.9},{x:.4,y:.4,w:.6,h:.6,o:1}],S.types.slide=[{x:.4,y:1,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.9,w:.6,h:.6,o:1},{x:.4,y:.8,w:.6,h:.6,o:1},{x:.4,y:.7,w:.6,h:.6,o:1},{x:.4,y:.6,w:.6,h:.6,o:1},{x:.4,y:.5,w:.6,h:.6,o:1},{x:.4,y:.4,w:.6,h:.6,o:1}],S.run=function(e,t,o,a){var s=S.types[i()?"none":r.animation];return a=o===!0?"undefined"!=typeof a?a:s.length-1:"undefined"!=typeof a?a:0,t=t?t:function(){},a<s.length&&a>=0?(T(n(e,s[a]),E[r.type]),p=setTimeout(function(){o?a-=1:a+=1,S.run(e,t,o,a)},S.duration),L.setIcon(l),void 0):void t()},C(),{badge:A,video:R,image:U,webcam:k,reset:I.reset,browser:{supported:w.supported}}};"undefined"!=typeof define&&define.amd?define([],function(){return e}):"undefined"!=typeof module&&module.exports?module.exports=e:this.Favico=e}();